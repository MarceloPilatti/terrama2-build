version: "3.3"

networks:
  net:
    external:
      name: "%%TERRAMA2_PROJECT_NAME%%_net"

services:

 server:
  build:
    context: .
    dockerfile: report-server/Dockerfile
  image: terrama2/report-server:1.0.0
  restart: "always"
  environment:
      - NODE_ENV=production
  volumes:
      - ./report-server/config.json:/app/config/config.json
      - ./report-server/geoserver-conf/config.json:/app/geoserver-conf/config.json
      - documents_vol:/app/documentos
      - "report_vol:/data"
  ports:
      - "0.0.0.0:%%REPORT_SERVER_PORT%%:3200"
  networks:
      - net

 client:
  build:
    context: .
    dockerfile: report-client/Dockerfile
  image: terrama2/report-client:1.0.0
  restart: "always"
  volumes:
      - "terrama2_shared_vol:/shared-data"
      - "report_vol:/data"
  ports:
      - "0.0.0.0:%%REPORT_CLIENT_PORT%%:80"
  networks:
      - net

volumes:
  documents_vol:
  report_vol:
  terrama2_shared_vol:
    external:
      name: "terrama2_shared_vol"